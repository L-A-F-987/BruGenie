cmake_minimum_required(VERSION 3.1.0)

project(LoadCellApp VERSION 1.0.0 LANGUAGES CXX)

# Set C++ standard to C++14
set(CMAKE_CXX_STANDARD 14)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Default build type if not specified
if(NOT CMAKE_BUILD_TYPE AND NOT CMAKE_CONFIGURATION_TYPES)
  set(CMAKE_BUILD_TYPE "RelWithDebInfo" CACHE STRING "Build type" FORCE)
endif()

# Add common compile options
add_compile_options(-Wall -Wconversion -Wextra -pedantic)

# Find libgpiod using pkg-config
find_package(PkgConfig REQUIRED)
pkg_check_modules(GPIOD REQUIRED libgpiod)

# Include directories: libgpiod and current source directory (for ads1115rpi.h)
include_directories(${GPIOD_INCLUDE_DIRS} ${CMAKE_CURRENT_SOURCE_DIR})

# Build the ADS1115rpi library as a static library
add_library(ads1115rpi STATIC ads1115rpi.cpp)
target_include_directories(ads1115rpi PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})
target_link_libraries(ads1115rpi ${GPIOD_LIBRARIES})

# Build the main executable (load cell application)
add_executable(loadcell main.cpp)
target_link_libraries(loadcell PRIVATE ads1115rpi ${GPIOD_LIBRARIES} pthread)

# Optionally, set up installation targets
install(TARGETS loadcell ads1115rpi
        RUNTIME DESTINATION bin
        LIBRARY DESTINATION lib
        ARCHIVE DESTINATION lib)
